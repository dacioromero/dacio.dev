<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta name=author content="Dacio Romero"><meta name=description content="Photo by Tim Gouw on Unsplash
Managing Memory    An assignment that Jasmine and I had recently done for my instructor, Alan Davis, at Make School was given a large list of phone routes consisting of their standardized prefixes and costs.
The task was for increasing amounts of routes and phone numbers to find the longest matches and their prices.
Project Readme
Attempts    List    One being performing linear search on a list of phone numbers because I couldn&rsquo;t figure out a way to perform binary search."><meta name=keywords content="blog,developer"><meta name=twitter:card content="summary"><meta name=twitter:title content="Python Memory Management"><meta name=twitter:description content="Photo by Tim Gouw on Unsplash
Managing Memory    An assignment that Jasmine and I had recently done for my instructor, Alan Davis, at Make School was given a large list of phone routes consisting of their standardized prefixes and costs.
The task was for increasing amounts of routes and phone numbers to find the longest matches and their prices.
Project Readme
Attempts    List    One being performing linear search on a list of phone numbers because I couldn&rsquo;t figure out a way to perform binary search."><meta property="og:title" content="Python Memory Management"><meta property="og:description" content="Photo by Tim Gouw on Unsplash
Managing Memory    An assignment that Jasmine and I had recently done for my instructor, Alan Davis, at Make School was given a large list of phone routes consisting of their standardized prefixes and costs.
The task was for increasing amounts of routes and phone numbers to find the longest matches and their prices.
Project Readme
Attempts    List    One being performing linear search on a list of phone numbers because I couldn&rsquo;t figure out a way to perform binary search."><meta property="og:type" content="article"><meta property="og:url" content="https://dacio.dev/posts/2019/05/15/python-memory/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-05-15T09:33:28-07:00"><meta property="article:modified_time" content="2019-05-15T09:33:28-07:00"><title>Python Memory Management · Dacio Romero</title><link rel=canonical href=https://dacio.dev/posts/2019/05/15/python-memory/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.93c41bf1e522f85ecda7355985f09000f71fc1d64dda9f74051b0fa06210e93f.css integrity="sha256-k8Qb8eUi+F7NpzVZhfCQAPcfwdZN2p90BRsPoGIQ6T8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.f37febc669ce189201c1918fac1948a254686c8d366a312c2d72b2bb71ad97d1.css integrity="sha256-83/rxmnOGJIBwZGPrBlIolRobI02ajEsLXKyu3Gtl9E=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><meta name=generator content="Hugo 0.98.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Dacio Romero</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://dacio.dev/posts/2019/05/15/python-memory/>Python Memory Management</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2019-05-15T09:33:28-07:00>May 15, 2019</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/programming/>Programming</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/python/>Python</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/make-school/>Make School</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/memory-management/>Memory Management</a></span></div></div></header><div><p><img src=https://source.unsplash.com/1K9T5YiZ2WU alt=Hero></p><p>Photo by Tim Gouw on Unsplash</p><h1 id=managing-memory>Managing Memory
<a class=heading-link href=#managing-memory><i class="fa fa-link" aria-hidden=true></i></a></h1><p>An assignment that <a href=https://medium.com/@jasmine.yhumbert>Jasmine</a> and I had recently done for my instructor, <a href=https://www.linkedin.com/in/alancdavis/>Alan Davis</a>, at <a href=https://www.makeschool.com/>Make School</a> was given a large list of phone routes consisting of their standardized prefixes and costs.</p><p>The task was for increasing amounts of routes and phone numbers to find the longest matches and their prices.</p><p><a href=https://github.com/Make-School-Courses/CS-1.3-Core-Data-Structures/blob/a622779357b055f925feb5f000996cb26c2ddf66/project/ReadMe.md>Project Readme</a></p><h2 id=attempts>Attempts
<a class=heading-link href=#attempts><i class="fa fa-link" aria-hidden=true></i></a></h2><h4 id=list>List
<a class=heading-link href=#list><i class="fa fa-link" aria-hidden=true></i></a></h4><p>One being performing linear search on a list of phone numbers because I couldn&rsquo;t figure out a way to perform binary search.</p><p><a href=https://github.com/lacunahag/call_routing_project/blob/e05e1577fc2f946b268ac4451fd7e11d4a8d6501/scenario1.py>File</a></p><h4 id=dictionary>Dictionary
<a class=heading-link href=#dictionary><i class="fa fa-link" aria-hidden=true></i></a></h4><p>Our next step was to throw it all into a dictionary and keep removing characters off of my numbers until there was a match.</p><p><a href=https://github.com/lacunahag/call_routing_project/blob/e8d1fbe7a2d8560fd27e1b99ab9b445ad994e2a1/scenario2.py>File</a></p><h4 id=trie>Trie
<a class=heading-link href=#trie><i class="fa fa-link" aria-hidden=true></i></a></h4><p>Jasmine said that <a href=https://en.wikipedia.org/wiki/Trie>tries</a> might be a good solution. You can read more about them <a href=https://medium.com/basecs/trying-to-understand-tries-3ec6bede0014>here</a>. Basically, they are a way of storing sequences of values, most commonly being strings.</p><p><img src=https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Trie_example.svg/819px-Trie_example.svg.png alt=Trie></p><p>Diagram - <a href=https://commons.wikimedia.org/wiki/File:Trie_example.svg>Source</a></p><p>To our dismay, it was using <strong><em>3 GB of RAM</em></strong> on a 10 million route dataset! When Jasmine tried to build her own it actually crashed on her laptop with 8 GB of RAM in total.</p><p><strong><em>It was time to track down where all our RAM is going.</em></strong></p><h1 id=tips-and-resources>Tips and Resources
<a class=heading-link href=#tips-and-resources><i class="fa fa-link" aria-hidden=true></i></a></h1><p>Through my attempts to optimize the memory, I have some pointers.</p><h2 id=pymplerhttpspythonhostedorgpympler><a href=https://pythonhosted.org/Pympler/>Pympler</a>
<a class=heading-link href=#pymplerhttpspythonhostedorgpympler><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Pympler is a powerful tool to analyze memory usage.</p><h3 id=pymplerasizeofasizeofhttpspythonhostedorgpymplerlibraryasizeofhtmlhighlightasizeof20asizeofpymplerasizeofasizeof><a href="https://pythonhosted.org/Pympler/library/asizeof.html?highlight=asizeof%20asizeof#pympler.asizeof.asizeof">pympler.asizeof.asizeof</a>
<a class=heading-link href=#pymplerasizeofasizeofhttpspythonhostedorgpymplerlibraryasizeofhtmlhighlightasizeof20asizeofpymplerasizeofasizeof><i class="fa fa-link" aria-hidden=true></i></a></h3><p>This function recursively checks every object referenced by several objects allowing you to get the actual size in bytes.</p><p><img src=asizeof.png alt=Example></p><p>That&rsquo;s a whopping 1.2 GB!</p><h3 id=pymplertrackersummarytrackerhttpspythonhostedorgpymplerlibrarytrackerhtmlhighlightsummarytrackerpymplertrackersummarytracker><a href="https://pythonhosted.org/Pympler/library/tracker.html?highlight=summarytracker#pympler.tracker.SummaryTracker">pympler.tracker.SummaryTracker</a>
<a class=heading-link href=#pymplertrackersummarytrackerhttpspythonhostedorgpymplerlibrarytrackerhtmlhighlightsummarytrackerpymplertrackersummarytracker><i class="fa fa-link" aria-hidden=true></i></a></h3><p>This class has a function called <code>print_diff</code> shows you how many of each type of new object there are and the amount of memory that they take up. This is useful</p><p><img src=summary-tracker.png alt=Example></p><p>This tracker is telling me that I should figure out how to <em>reduce the number of subtries</em> that I&rsquo;m creating and perhaps find another way to use lists.</p><p>The first time I used it I realized that I needed to <strong>stop using so many dictionaries</strong>. If I know the exact inputs my Trie will be receiving I could use one dictionary to map characters to parts of a list.</p><h3 id=much-much-more>Much much more
<a class=heading-link href=#much-much-more><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Pympler has much more in store, I&rsquo;d highly recommend going through their documentation and seeing if there&rsquo;s anything of use.</p><h2 id=tracemallochttpsdocspythonorg3librarytracemallochtml><a href=https://docs.python.org/3/library/tracemalloc.html>tracemalloc</a>
<a class=heading-link href=#tracemallochttpsdocspythonorg3librarytracemallochtml><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Python 3.4 and up has a built-in memory tracer, but I admit I don&rsquo;t have as much experience with it.</p><h2 id=use-__slots__>Use <code>__slots__</code>!
<a class=heading-link href=#use-__slots__><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Slots in Python are a pretty quick way to reduce the memory usage of an object. By default Python uses dictionaries to store class attributes which you find in the variable <code>__dict__</code>.</p><p><img src=class-dict.png alt=Example></p><p>If you instead explicitly define which variables using <code>__slots__</code> your object will have you can save a <em>substantial</em> amount of memory which pays off with recursive data structures like tries.</p><p><img src=class-slots.png alt=Example></p><p>By using slots more than halved our memory usage while still storing the same data.</p><h2 id=default-to-none>Default to None
<a class=heading-link href=#default-to-none><i class="fa fa-link" aria-hidden=true></i></a></h2><p>In my Tries, I realized that there are a lot of moments when a Trie won&rsquo;t have any subtries, but I still made a list for them.</p><p>Although there&rsquo;s a bit of a tradeoff, I believe in situations where you have 4.6 million of the same object it&rsquo;s worth it to default variables to None and only creates them when necessary</p><p><img src=none.png alt=Example></p><p>The difference in sizes.</p><p>You can see that with more than <strong>4 million nodes</strong> the size of both empty dictionaries and empty lists can add up <em>incredibly</em> quickly.</p><blockquote><p>You should only create data structures when they&rsquo;re being used.</p></blockquote><h2 id=use-smaller-types>Use Smaller Types
<a class=heading-link href=#use-smaller-types><i class="fa fa-link" aria-hidden=true></i></a></h2><p>You might fall into the pattern of reusing one datatype multiple times because it worked like a dictionary.</p><blockquote><p>Nested dictionaries are common, but what if the keys are predictable?</p></blockquote><p>In our phone number problem, I realized that there were only going to be 11 characters &ldquo;+1234567890&rdquo;, so why should I use a data structure optimized for arbitrary keys?</p><p>I decided it would be worth it to create a &ldquo;mapper&rdquo; that converts a character into an index in a list.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> __init__(self, keys <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>, items <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>, _value <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>, _mapper <span style=color:#f92672>=</span>  <span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> _mapper:
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>_mapper <span style=color:#f92672>=</span> _mapper
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>elif</span> keys:
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>_mapper <span style=color:#f92672>=</span> {item: index <span style=color:#66d9ef>for</span> index, item <span style=color:#f92672>in</span> enumerate(keys)}
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#39;keys or _mapper must be provided&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  self<span style=color:#f92672>.</span>_subtries <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span></code></pre></div><p><a href=https://github.com/lacunahag/call_routing_project/commit/4605171ef87696d555b880f41f9101b5041bc54c>Commit</a></p><p>This allows me to generate a mapper at the root and pass it down. I can then use it to get the index of where a Trie <em>should</em> be. This was <strong>by far</strong> one of the best optimizations that I made and reduced my memory usage from around <strong>3 GB to 1.5 GB</strong>.</p><h1 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa fa-link" aria-hidden=true></i></a></h1><p>Optimizing your code for memory usage might not be one of the first things you might think to do. Once you&rsquo;re operating at scale, however, it becomes just as important as speed.</p><p>Take a look at <a href=https://github.com/lacunahag/call_routing_project>our repo</a> if you want to see our solution to the phone numbers problem</p><blockquote><p>I&rsquo;m looking for internships, so don&rsquo;t be afraid to reach out! <a href=https://www.linkedin.com/in/dacioromero/>My LinkedIn</a></p></blockquote></div><footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//dacio.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2022
Dacio Romero</section></footer></main><script src=/js/coder.min.f48f8b52310e1a89d74558ac6718cde27d388efc7f13bd1cec79598a4fadce38.js integrity="sha256-9I+LUjEOGonXRVisZxjN4n04jvx/E70c7HlZik+tzjg="></script></body></html>